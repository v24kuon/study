<%= render 'devise/shared/flash_messages' %>

<div class="container">
  <div class="row">
    <div class="col-sm-8">
      <div id="post_lists"><%= render 'post_list' %></div>
      <%= link_to_next_page @posts, 'もっと見る', remote: true, id: 'view_more' %>
    </div>

<div class="col-sm-4 text-center">
  <h3>ランキング<%= Time.current.year %>年<%= Time.current.month %>月</h3>
    <table class="table table-hover table-inverse">
      <thead>
        <tr>
          <th>順位</th>
          <th>ユーザー</th>
          <th>合計時間(h)</th>
        </tr>
      </thead>

      <tbody>
        <% @ranking_users.each.with_index(1) do |user, i| %>
        <tr>
          <td>
              第
              <%= i %>
              位
          </td>
          <td><%= link_to user.name, user %>さん</td>
          <td><%= (user.posts.where(:created_at=> Time.current.beginning_of_month..Time.current.end_of_month).pluck(:hour).sum + user.posts.where(:created_at=> Time.current.beginning_of_month..Time.current.end_of_month).pluck(:minutes).sum / 60).round(1) %></td>
        </tr>
        <% end %>
      </tbody>
    </table>
  <% @occupations.each do |occupation| %>
    <ul class="list-group">
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <%= link_to occupation, posts_path(occupation_name: occupation) %>
        <span class="badge badge-primary badge-pill">14</span>
      </li>
    </ul>
  <% end %>
</div>
  </div>
</div>

<div class="d-flex justify-content-center">
<%= paginate @posts %>
</div>

