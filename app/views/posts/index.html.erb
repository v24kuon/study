<%= render 'devise/shared/flash_messages' %>

<div class="container">
  <div class="row">
  <div class="col-sm-8">
<% @posts.each do |post| %>
  <div class="card mb-4 border-secondary">
    <div class="card-header border-secondary">
      <%= link_to(post.user) do %>
      <%= attachment_image_tag post.user, :image, :fill, 60, 60, class: "rounded-circle", fallback: "sample.jpg", size:'50x50'%>
      <% end %>
      <%= link_to post.user.name, post.user %>
      <div class="float-right">
      <% if post.created_at == post.updated_at %>
        投稿日:<%= post.created_at.strftime('%Y/%m/%d') %>
      <% else %>
        更新日:<%= post.updated_at.strftime('%Y/%m/%d') %>
      <% end %>
      <font color="#808080">
      <% if post.created_at == post.updated_at %>
        <%= time_ago_in_words(post.created_at) %>前
      <% else %>
        <%= time_ago_in_words(post.updated_at) %>前
      <% end %>
      </font>
      </div>
      </div>
    <div class="row no-gutters">
      <div class="col-sm-4">
        <%= attachment_image_tag post, :image, :fill, 300, 300, class: "card-img", fallback: "sample.jpg"%>
      </div>
      <div class="card-body">
        <div class="col-sm-8">
          <h5 class="card-title"><%= render 'posts/tag_list', tag_list: post.tag_list %></h5>
          <p class="card-text"><%= post.body %></p>
        </div>
      </div>
    </div>
      <div class="card-footer text-muted border-secondary">
        <div class="d-flex">
        <div class="p-2">
        <div id="favorites_buttons_<%= post.id %>">
          <%= render partial: 'favorites/like', locals: { post: post} %>
        </div>
        </div>
        <div class="p-2">
        <i class="fas fa-comment-dots faa-float animated" style="color: #FFD700;"></i>
        <%= post.comments.count %>
        </div>
        <%= link_to 'コメント', post, class: 'ml-auto p-2 btn btn-info' %>
        </div>
        <div class="float-right">
        <i class="fas fa-book-reader faa-tada animated" style="color: #000066;"></i>
        <%= total_hour(post.hour,post.minutes) %>
        </div>
      </div>
  </div>
<% end %>
  </div>


<div class="col-sm-4 text-center">
  <h3>ランキング<%= Time.current.year %>年<%= Time.current.month %>月</h3>
    <table class="table table-hover table-inverse">
      <thead>
        <tr>
          <th>順位</th>
          <th>ユーザー</th>
          <th>合計時間(h)</th>
        </tr>
      </thead>

      <tbody>
        <% @ranking_users.each.with_index(1) do |user, i| %>
        <tr>
          <td>
              第
              <%= i %>
              位
          </td>
          <td><%= link_to user.name, user %>さん</td>
          <td><%= (user.posts.where(:created_at=> Time.current.beginning_of_month..Time.current.end_of_month).pluck(:hour).sum + user.posts.where(:created_at=> Time.current.beginning_of_month..Time.current.end_of_month).pluck(:minutes).sum / 60).round(1) %></td>
        </tr>
        <% end %>
      </tbody>
    </table>
</div>
</div>
</div>
<div class="d-flex justify-content-center">
<%= paginate @posts %>
</div>

<% @occupations.each do |occupation| %>
<%= link_to occupation, posts_path(occupation_name: occupation) %>
<% end %>



